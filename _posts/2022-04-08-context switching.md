# Context Switching

컴퓨터는 동시에 하나만 할 수 있다 !  
하지만 실제로 사용하다보면 유저입장에서는 동시에 여러 task들이 처리되고 있는것 처럼 느껴진다.  

그렇게 느껴지는 이유가 바로 context switching이다.  

컴퓨터는 여러 프로세스를 갖고 있고, 프로세스는 여러 thread를 갖고 있다.  

이걸 바로 멀티 프로세스 환경이라고 하는데,  
문제는 cpu는 하나의 프로세스만 실행가능하다.  

중간에 interupt라는 요청에 의해서 cpu는 계속해서 실행하고 있는 process를 교체하게 된다.  

즉 우리에게 여러가지가 동시에 일어나고 있는것 처럼 보이지만  
실제로는 cpu가 실행하고 있는 작업이 눈치채지 못할만큼 빠른 속도로 작업들을 교체하면서 실행하고 있는 것이다.  

이 교체의 작업의 context switching이라고 한다.  

자세하게 설명하면,  
멀티프로세스 환경에서 cpu가 하나의 프로세스를 실행하고 있는 상태에서 interupt 요청에 의해 다음 순위의 프로세스를 실행하게 될때,  
기존 프로세스의 상태 또는 register 값을 저장하고, cpu가 다음 프로세스를 수행하도록 새로운 프로세스의 상태 또는 register값을 교체하는 작업을 의미한다.  

## Context란 무엇인가 ?

문맥, 상태라는 번역이 되지만 os에서는 cpu가 프로세스를 실행하기 위한 해당 프로세스의 정보를 말한다.  
이 context는 프로세스의 pcb에 저장이 된다.  

## PCB
pcb는 무엇을 저장하고 있을까 ?  
1. 프로세스의 상태 : 생성, 준비, 수행, 대기, 중지
2. 프로그램 카운터 : 프로세스가 다음에 수행할 명령어의 위치
3. 레지스터 : 누산기, 스택, 색인 레지스터
4. 프로세스 번호

## Interrupt
interrupt란 cpu가 프로그램을 실행하고 있을때, 실행중인 프로그램 밖에서 예외상황이 발생해서 처리가 필요한 경우 발생한다.  

다음과 같은 종류가 있다.  

1. I/O request (입출력 요청할 때)
2. time slice expired (CPU 사용시간이 만료 되었을 때)
3. fork a child (자식 프로세스를 만들 때)
4. wait for an interrupt (인터럽트 처리를 기다릴 때)

## Scheduling  
위에서 cpu가 처리하길 기다리는 프로세스들이 있고, 프로세스들간의 우선순위가 있다고 했다.  
중요한건 이 우선순위를 정하는 것을 scheduling이라고 하고,  
해당 scheduling은 여러가지 알고리즘이 있다.  

가장 대표적인 round robin으로 정해진 시간만큼을 두고 cpu가 실행하고 시간이 끝나면 다음 순위의 프로세스를 실행하는 알고리즘이다.  

이 시간 단위가 적으면 context switching이 그만큼 자주 발생하게 된다.  

## 정리

context switching이 너무 자주 발생하면 좋지 않다.  
이 과정 자체에도 리소스와 시간이 소요되기 때문이다.  
