<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Singleton과 Spring" /><meta property="og:locale" content="en" /><meta name="description" content="Singleton Pattern" /><meta property="og:description" content="Singleton Pattern" /><link rel="canonical" href="https://hmcck27.github.io/posts/singleton%EA%B3%BC-Spring/" /><meta property="og:url" content="https://hmcck27.github.io/posts/singleton%EA%B3%BC-Spring/" /><meta property="og:site_name" content="개복치의 개발 블로그" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-03-23T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Singleton과 Spring" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Singleton Pattern","url":"https://hmcck27.github.io/posts/singleton%EA%B3%BC-Spring/","@type":"BlogPosting","headline":"Singleton과 Spring","dateModified":"2022-03-23T00:00:00+08:00","datePublished":"2022-03-23T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://hmcck27.github.io/posts/singleton%EA%B3%BC-Spring/"},"@context":"https://schema.org"}</script><title>Singleton과 Spring | 개복치의 개발 블로그</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="개복치의 개발 블로그"><meta name="application-name" content="개복치의 개발 블로그"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/jk.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">개복치의 개발 블로그</a></div><div class="site-subtitle font-italic">공부한걸 기록하자 !</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/hmcck27" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hmcck27','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Singleton과 Spring</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Singleton과 Spring</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/hmcck27">Choi Jin Kyu</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-03-23 00:00:00 +0800" data-toggle="tooltip" data-placement="bottom" title="Wed, Mar 23, 2022, 12:00 AM +0800" >Mar 23</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1758 words"> <em>9 min</em> read</span></div></div></div><div class="post-content"><h1 id="singleton-pattern">Singleton Pattern</h1><p>여기서 자바 싱글톤 = spring singleton을 예시로 생각해보자.<br /> Singleton은 어플리케이션 전역에서 하나만 존재하는 객체이다.</p><p>자바 JVM에서 딱 하나만 존재하는 객체 혹은 이런 디자인 패턴을 singleton이라고 한다.</p><hr /><h2 id="singleton-design-pattern">Singleton Design Pattern<a href="#singleton-design-pattern" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>클래스의 인스턴스가 딱 1개만 생성되는 것을 보장하는 디자인 패턴이다.<br /> 그래서 복수로 인스턴스를 생성하는 것을 막는 로직이 객체 생성에 필요하다.<br /> 다음과 같은 패턴을 말한다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingletonService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">SingletonService</span> <span class="n">instance</span> <span class="o">=</span><span class="k">new</span> <span class="nc">SingletonService</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">SingletonService</span> <span class="nf">getInstance</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nf">SingletonService</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">logic</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"call singleton instance"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이렇게 클래스를 만들면,<br /> 처음 static으로 선언하면서 static 영역에 객체가 생성된다.<br /> 그리고 해당 클래스의 생성자는 private이기 때문에 외부에서 생성자 호출이 불가능하다.<br /> 즉 그냥 생성자 자체를 막아놓은 것이다.<br /> 그리고 해당 객체를 가져오려면 getInstance()를 호출해야만 한다.<br /> instance는 이미 static 영역에 선언되어 있고 해당 instance를 가져오게 된다.</p><p>즉 외부에서는 늘 static 영역에 미리 선언되었던 instance만을 가져올 수 있게 된다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"singleton pattern obejct use"</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">singletonServiceTest</span><span class="o">()</span> <span class="o">{</span>

        <span class="nc">SingletonService</span> <span class="n">instance1</span> <span class="o">=</span> <span class="nc">SingletonService</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
        <span class="nc">SingletonService</span> <span class="n">instance2</span> <span class="o">=</span> <span class="nc">SingletonService</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"instance1 = "</span> <span class="o">+</span> <span class="n">instance1</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"instance2 = "</span> <span class="o">+</span> <span class="n">instance2</span><span class="o">);</span>

        <span class="n">assertThat</span><span class="o">(</span><span class="n">instance1</span><span class="o">).</span><span class="na">isSameAs</span><span class="o">(</span><span class="n">instance2</span><span class="o">);</span>

    <span class="o">}</span>
</pre></table></code></div></div><p>테스트 통과 !</p><hr /><h2 id="singleton-pattern-구현의-문제점">singleton pattern 구현의 문제점.<a href="#singleton-pattern-구현의-문제점" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>코드를 구현해줘야 한다.<li>DIP 위반이다. -&gt; 즉 클라이언트 코드가 해당 객체를 부르기 위해서는 구체화된 인스턴스를 가져오기 때문이다.<li>OCP 위빈이다. -&gt; 구체화된 클래스에 의존하기 때문에 사용할 클래스가 바뀌면 인스턴스도 바꿔줘야 한다.<li>테스트하기 어렵다.<li>내부 속성을 변경하거나 초기화하기 어렵다. -&gt; 전역에서 관리되기 때문에 함부로 속성을 변경하면 이걸 사용하는 다른 클라이언트 코드들에 문제가 생길 여지가 많다.<li>유연성이 떨어진다.</ol><hr /><h2 id="web-application과-singleton">web application과 singleton<a href="#web-application과-singleton" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>현대적인 application의 대부분은 web application이지만,<br /> 사실 application이라 함은 web만을 지칭하는 것은 아니다.</p><p>서버내에서 즉 컴퓨터내에서 특정 작업을 처리해주는 데몬같은 것도 어플리케이션이고<br /> 일정 시간마다 대용량의 작업을 처리하는 배치 프로그램도 어플리케이션이다.</p><p>스프링으로도 이렇게 데몬이나 배치같은 어플리케이션을 만들 수 있다.<br /> 스프링 배치라는 모듈이 있다 ! 물론 내가 개발해보지는 않았다…</p><p>대부분은 스프링 어플리케이션은 웹이다.<br /> 웹에서는 여러 고객이 동시에 요청한다.<br /> 그러면 요청마다 새로운 객체를 생성해서 반환하게 된다.</p><p>만약에 스프링의 DI container가 없는 상태에서 요청마다 객체를 생성하게 되면 다음과 같다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingletonTest</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"no spring only pure di container"</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">pureContainer</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">AppConfig</span> <span class="n">appConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AppConfig</span><span class="o">();</span>

        <span class="c1">// 1. 조회</span>
        <span class="nc">MemberService</span> <span class="n">memberService1</span> <span class="o">=</span> <span class="n">appConfig</span><span class="o">.</span><span class="na">memberService</span><span class="o">();</span>
        <span class="nc">MemberService</span> <span class="n">memberService2</span> <span class="o">=</span> <span class="n">appConfig</span><span class="o">.</span><span class="na">memberService</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"memberService1 = "</span> <span class="o">+</span> <span class="n">memberService1</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"memberService2 = "</span> <span class="o">+</span> <span class="n">memberService2</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>테스트 코드를 실행시켜보면,<br /> 다음과 같은 결과가 나온다.</p><blockquote><p>memberService1 = hello.core.member.MemberServiceImpl@71623278 memberService2 = hello.core.member.MemberServiceImpl@768b970c</p></blockquote><p>보다 싶이 새롭게 memberService를 할당받은 모습임을 알 수 있다.<br /> 만약 웹 어플리케이션 같은 경우 이런식으로 객체를 늘 생성하면<br /> 당연히 자원의 소모가 커진다.</p><p>따라서 웹에서는 이렇게 singleton패턴이 아닌 경우 메모리라던가 관리에 지장이 생길 수 밖에 없다.</p><p>singleton같은 경우는 어플리케이션 전역에 하나만 존재한다.<br /> 요청이 동시에 복수가 들어와도 하나만 있는 객체를 반환한다면 늘 새로운 객체를 생성하는 자원 소모를 줄일 수 있다.</p><p>여기서 memberService를 스프링 빈으로 생성하고 spring container가 관리하도록 한다면<br /> 우리는 해당 객체를 다시 생성할 필요없이 전역으로 생성된 인스턴스를 갖다 쓰면 된다.</p><hr /><h2 id="spring-container">Spring Container<a href="#spring-container" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>spring에서는 spring container가 기본적으로 bean으로 생성된 객체는 singleton으로 만든다.<br /> 이게 singleton의 패턴의 문제점을 해결하면서 객체를 singleton으로 관리하게 해준다.</p><p>DIP, OCP를 지키면서 객체의 단일성을 보장해주고 개발자가 추가적으로 singleton 패턴 디자인을 할 필요가 없다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingletonTest</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"spring container and singleton"</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">springContainer</span><span class="o">()</span> <span class="o">{</span>

        <span class="nc">AnnotationConfigApplicationContext</span> <span class="n">ac</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="nc">AppConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="c1">// 1. 조회</span>
        <span class="nc">MemberService</span> <span class="n">memberService1</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="nc">MemberService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="nc">MemberService</span> <span class="n">memberService2</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="nc">MemberService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"memberService1 = "</span> <span class="o">+</span> <span class="n">memberService1</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"memberService2 = "</span> <span class="o">+</span> <span class="n">memberService2</span><span class="o">);</span>

        <span class="n">assertThat</span><span class="o">(</span><span class="n">memberService1</span><span class="o">).</span><span class="na">isSameAs</span><span class="o">(</span><span class="n">memberService2</span><span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>memberService1 = hello.core.member.MemberServiceImpl@1349883 memberService2 = hello.core.member.MemberServiceImpl@1349883</p></blockquote><p>다음과 같이 bean 설정을 주입한 ApplicationContext에서 가져온 객체는 동일한 instance이다.</p><p>spring container가 지원하는 bean들은 대부분 singleton이다.<br /> 물론 bean scope에 맞춰서 다른 bean 종류도 있긴하다.</p><p>그건 IoC Container 포스트에서 자세히 다룰 예정이다.</p><hr /><h2 id="singleton-방식의-주의점">singleton 방식의 주의점<a href="#singleton-방식의-주의점" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>위에서 간단히 짚고 넘어갔듯이 singleton 패턴으로 디자인된 객체들은<br /> 절대로 !! 절대로 state가 존재해서는 안된다.</p><p>만약에 이런 singleton 객체가 있다고 가정해보자.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingletonService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">SingletonService</span> <span class="n">instance</span> <span class="o">=</span><span class="k">new</span> <span class="nc">SingletonService</span><span class="o">();</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">price</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">SingletonService</span> <span class="nf">getInstance</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nf">SingletonService</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">order</span><span class="o">(</span><span class="kt">int</span> <span class="n">price</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">price</span> <span class="o">=</span> <span class="n">price</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getPrice</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">price</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">logic</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"call singleton instance"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>SingletonService는 price라는 가변 변수가 있다.<br /> 해당 변수를 바꾸는 함수 order가 있다면 이는 추후에 큰 문제가 될 수 있다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">statefulServiceSingleton</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">AnnotationConfigApplicationContext</span> <span class="n">ac</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="nc">TestConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="nc">SingletonService</span> <span class="n">service1</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="nc">SingletonService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="nc">SingletonService</span> <span class="n">service2</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="nc">SingletonService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="c1">// threadA : 10000원 주문</span>
    <span class="n">service1</span><span class="o">.</span><span class="na">order</span><span class="o">(</span><span class="mi">10000</span><span class="o">);</span>

    <span class="c1">// threadB : 10000원 주문</span>
    <span class="n">service2</span><span class="o">.</span><span class="na">order</span><span class="o">(</span><span class="mi">20000</span><span class="o">);</span>

    <span class="kt">int</span> <span class="n">price1</span> <span class="o">=</span> <span class="n">service1</span><span class="o">.</span><span class="na">getPrice</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">price2</span> <span class="o">=</span> <span class="n">service2</span><span class="o">.</span><span class="na">getPrice</span><span class="o">();</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"price1 = "</span> <span class="o">+</span> <span class="n">price1</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"price2 = "</span> <span class="o">+</span> <span class="n">price2</span><span class="o">);</span>

    <span class="nc">Assertions</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span><span class="n">service1</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">service2</span><span class="o">.</span><span class="na">getPrice</span><span class="o">());</span>

<span class="o">}</span>
</pre></table></code></div></div><p>이 코드에서의 결과물은</p><blockquote><p>price1 = 10000<br /> price2 = 20000</p></blockquote><p>가 아니구</p><p>다음과 같다.</p><blockquote><p>price1 = 20000<br /> price2 = 20000</p></blockquote><p>결국 변수를 함부로 바꾸니까 문제가 생긴것이다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/spring/'>Spring</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/spring/" class="post-tag no-text-decoration" >Spring</a> <a href="/tags/singleton/" class="post-tag no-text-decoration" >Singleton</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Singleton과 Spring - 개복치의 개발 블로그&url=https://hmcck27.github.io/posts/singleton%EA%B3%BC-Spring/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Singleton과 Spring - 개복치의 개발 블로그&u=https://hmcck27.github.io/posts/singleton%EA%B3%BC-Spring/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Singleton과 Spring - 개복치의 개발 블로그&url=https://hmcck27.github.io/posts/singleton%EA%B3%BC-Spring/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/spring-IoC(2)/">Spring IoC (2)</a><li><a href="/posts/Annotation/">Annotation</a><li><a href="/posts/DtoToMap/">Dto to Map, with naming convention</a><li><a href="/posts/DTO%EB%A1%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B0%9B%EA%B8%B0/">controller 파라미터 map -> dto 변환과정</a><li><a href="/posts/%EB%B0%B1%EC%A4%80-14226/">백준 14226 이모티콘</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/%EC%9D%B8%EC%A6%9D-%EC%9D%B8%EA%B0%80/">인증/인가</a> <a class="post-tag" href="/tags/implementation/">implementation</a> <a class="post-tag" href="/tags/annotation/">Annotation</a> <a class="post-tag" href="/tags/bfs/">BFS</a> <a class="post-tag" href="/tags/dependency-injection/">Dependency Injection</a> <a class="post-tag" href="/tags/ioc/">IoC</a> <a class="post-tag" href="/tags/jackson/">Jackson</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Spring-%EC%9D%98%EC%A1%B4%EA%B4%80%EA%B3%841/"><div class="card-body"> <em class="timeago small" date="2022-02-10 00:00:00 +0800" >Feb 10</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring 의존관계 (1)</h3><div class="text-muted small"><p> 의존 관계 Spring에서는 의존관계를 잘 설정해야 한다. 사실 Spring에서는 규격으로 정해진 방법이 있다. 해당 방법을 사용하면 무탈하게 개발할 수는 있으나 다른 방법들도 존재한다. Spring에서 어떻게 의존관계를 설정하는지 알아보기 전에 일단 의존관계가 무엇인지 부터 차근차근 알아보자. 의존관계 한번 생각해보자. 내가 피자를 먹는다...</p></div></div></a></div><div class="card"> <a href="/posts/Spring-%EC%9D%98%EC%A1%B4%EA%B4%80%EA%B3%842/"><div class="card-body"> <em class="timeago small" date="2022-02-11 00:00:00 +0800" >Feb 11</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring 의존관계 (2)</h3><div class="text-muted small"><p> Spring 의존관계 (2) 앞서 자바에서 의존관계를 어떻게 주입하는지, 또 의존관계를 어떻게 하면 추상화 객체와 인터페이스를 사용해서 확장에 유리하게 주입하는지 알아봤다. 의존관계 주입이라는 용어도 알아봤는데, 런타임시에 어떤 구현체와 관계를 맺을지 결정하는 것이다. 토비의 스프링에서는 의존관계 주입을 다음과 같이 설명한다. 클래스 모델...</p></div></div></a></div><div class="card"> <a href="/posts/SOLID%EC%99%80Spring/"><div class="card-body"> <em class="timeago small" date="2022-02-17 00:00:00 +0800" >Feb 17</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SOLID와 Spring</h3><div class="text-muted small"><p> 스프링 기초 스프링의 기술들 스프링의 기술을 다양하다. 가장 쉽게 접할 수 있는 Spring Framework, Spring Boot 부터 각기 필요한 기능들을 구현하고 싶을때 사용하는 Spring Security, Spring Data, Spring session, Spring Rest Docs, Spring Batch, Spring Cloud,...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/nginx%EC%99%80apache/" class="btn btn-outline-primary" prompt="Older"><p>nginx와 apache</p></a> <a href="/posts/spring-IoC(1)/" class="btn btn-outline-primary" prompt="Newer"><p>Spring IoC (1)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/hmcck27">Choi Jin Kyu</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/%EC%9D%B8%EC%A6%9D-%EC%9D%B8%EA%B0%80/">인증/인가</a> <a class="post-tag" href="/tags/implementation/">implementation</a> <a class="post-tag" href="/tags/annotation/">Annotation</a> <a class="post-tag" href="/tags/bfs/">BFS</a> <a class="post-tag" href="/tags/dependency-injection/">Dependency Injection</a> <a class="post-tag" href="/tags/ioc/">IoC</a> <a class="post-tag" href="/tags/jackson/">Jackson</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
