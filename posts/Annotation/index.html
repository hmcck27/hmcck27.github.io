<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Annotation" /><meta property="og:locale" content="en" /><meta name="description" content="Annotation" /><meta property="og:description" content="Annotation" /><link rel="canonical" href="https://hmcck27.github.io/posts/Annotation/" /><meta property="og:url" content="https://hmcck27.github.io/posts/Annotation/" /><meta property="og:site_name" content="개복치의 개발 블로그" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-04-04T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Annotation" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Annotation","url":"https://hmcck27.github.io/posts/Annotation/","@type":"BlogPosting","headline":"Annotation","dateModified":"2022-04-12T17:22:55+08:00","datePublished":"2022-04-04T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://hmcck27.github.io/posts/Annotation/"},"@context":"https://schema.org"}</script><title>Annotation | 개복치의 개발 블로그</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="개복치의 개발 블로그"><meta name="application-name" content="개복치의 개발 블로그"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/jk.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">개복치의 개발 블로그</a></div><div class="site-subtitle font-italic">공부한걸 기록하자 !</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/hmcck27" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hmcck27','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Annotation</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Annotation</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/hmcck27">Choi Jin Kyu</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-04-04 00:00:00 +0800" data-toggle="tooltip" data-placement="bottom" title="Mon, Apr 4, 2022, 12:00 AM +0800" >Apr 4</em> </span> <span> Updated <em class="timeago" date="2022-04-12 18:22:55 +0900 " data-toggle="tooltip" data-placement="bottom" title="Tue, Apr 12, 2022, 6:22 PM +0900" >Apr 12</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2335 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><h1 id="annotation">Annotation</h1><p>우리가 자바로 개발하면 필요할때마다 annotation을 사용한다.<br /> interface를 만들면 @Override를 사용하게 되고 lombok을 사용하면 @Getter, @Setter등을 사용하게 된다. 또 validation에서는 @NotNull과 같은 annotation을 사용한다.</p><p>문제는 @Getter라고 적어준다고 해도 실제 우리 코드에는 get 함수가 구현되어 있지 않다.</p><p>하지만 난 단순히 code에 annotation을 작성했을 뿐인데,<br /> 어떻게 실제 코드가 변화할 수 있는건지 의문이 있었다.</p><hr /><h2 id="annotation이-뭘까-">Annotation이 뭘까 ?<a href="#annotation이-뭘까-" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Annotation은 metadata이다. 즉 data에 대한 data이다.<br /> 예를 들어서 다음 코드를 보자.<div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nd">@Override</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
<span class="k">return</span> <span class="s">"This is String Representation of current object."</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>코드에서 우리는 toString()함수를 override했다.<br /> 그리고 메소드 위에 @Override를 작성했다.<br /> @Override annotation을 붙이지 않아도 물론 override된다.<br /> 그렇다면 왜 Annotation을 사용하는 걸까 ?<br /> @Override는 javac에게 해당 메소드는 override하는 메소드임을 알려준다.<br /> 즉 메소드에 대한 metadata이다.<br /> 그리고 만약에 parent class에 override할 method가 없다면 compile 에러를 만든다.</p></ol><p>만약에 @Override를 붙이지 않았다면 실제로 parent에 toString()이 있는지 체크하지 않을것이고, 개발자가 원하는 방향 = 이 메소드는 override 메소드야 임을 compiler에서는 알 수가 없다. 물론 compile은 제대로 될겠지만 워하는 방향으로 작동하지 않을 것이다.</p><p>따라서 왜 annotation을 붙이는지 명확하게 알 수 있다.</p><ol><li><p>Annotation은 적절한 코드를 생성한다.<br /> Lombok의 @Getter같은 경우는 개발자가 직접 getter를 구현하지 않아도 실제로 컴파일 타이밍시 코드를 생성해준다.<br /> 만약에 boilerplate code를 줄이고 생산성을 늘리고 싶다면 코드를 삽입해주는 Annotation은 큰 도움이 된다.</p><li><p>run time시 특정 기능을 실행하도록 정보를 제공한다. spring 같은 framework에서는 DI를 위한 annotation을 다는 경우가 많다. 이런 annotation은 run time에서 annotation이 적용된 element의 역할을 정의하게 된다.</p></ol><hr /><h2 id="왜-annotation이-필요할까-">왜 Annotation이 필요할까 ?<a href="#왜-annotation이-필요할까-" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>annotation이전에는 xml을 사용했다.<br /> 하지만 xml은 유지보수가 쉽지 않았다.<br /> xml보다 코드에 친숙한 metadata를 위해서 annotation을 만들게 되었다.</p><p>물론 xml과 annotation은 각각 장단점이 있다.<br /> xml은 코드 자체에서 loosely coupled 즉 의도적으로 느슨한 결합을 만들 수 있다.<br /> 즉 configuration과 code의 결합성을 약하게 하는것이다.</p><p>만약에 application 전역에서 적용되는 상수, 파라미터를 설정하고 싶은 경우 code에 묶여있지 않은 xml를 사용하는것이 더 좋은 선택일 수 있다.<br /> 하지만 code의 일부분에만 적용되도록 하고 싶다면 그런 경우에는 xml보다는 annotation을 사용하게 나을 것이다.</p><hr /><h2 id="custom-annotation을-만드는-방법">Custom Annotation을 만드는 방법<a href="#custom-annotation을-만드는-방법" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>일단은 @Override 어노테이션을 확인해보자.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">)</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">SOURCE</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">Override</span> <span class="o">{</span>
<span class="o">}</span>
</pre></table></code></div></div><p>해당 어노테이션에서는 별일 안한다.<br /> 그냥 단순하게 parent class에 해당 method가 존재하는지 체크할 뿐이다.<br /> Annotation에는 본질적으로 buisness logic이 들어가 있지 않다.<br /> 마치 interface처럼 logic은 제외하고 target element가 사용할 수 있어야 한다.</p><p>해당 annotation을 보고 jvm은 bytecode level에서 동작할 수 있게끔 작동한다.</p><p>일단은 Annotation이 들어갈 수 있는 여러 기본적인 Annotation들에 대해서 알아보자.</p><ol><li>@Target - 어노테이션의 적용 대상<li>@Retention - 어노테이션이 유지 되는 기간</ol><p>Target의 경우는 다음과 같다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">ElementType</span> <span class="o">{</span>
    <span class="cm">/** Class, interface (including annotation type), or enum declaration */</span>
    <span class="no">TYPE</span><span class="o">,</span>

    <span class="cm">/** Field declaration (includes enum constants) */</span>
    <span class="no">FIELD</span><span class="o">,</span>

    <span class="cm">/** Method declaration */</span>
    <span class="no">METHOD</span><span class="o">,</span>

    <span class="cm">/** Formal parameter declaration */</span>
    <span class="no">PARAMETER</span><span class="o">,</span>

    <span class="cm">/** Constructor declaration */</span>
    <span class="no">CONSTRUCTOR</span><span class="o">,</span>

    <span class="cm">/** Local variable declaration */</span>
    <span class="no">LOCAL_VARIABLE</span><span class="o">,</span>

    <span class="cm">/** Annotation type declaration */</span>
    <span class="no">ANNOTATION_TYPE</span><span class="o">,</span>

    <span class="cm">/** Package declaration */</span>
    <span class="no">PACKAGE</span><span class="o">,</span>

    <span class="cm">/**
     * Type parameter declaration
     *
     * @since 1.8
     */</span>
    <span class="no">TYPE_PARAMETER</span><span class="o">,</span>

    <span class="cm">/**
     * Use of a type
     *
     * @since 1.8
     */</span>
    <span class="no">TYPE_USE</span>
<span class="o">}</span>
</pre></table></code></div></div><p>보면 적용되는 대상에 따라서 element를 설정해주면 됨을 알 수 있다.<br /> 예를 들어서 @Getter는 클래스대상이니까 TYPE,<br /> @Override의 경우는 method대상이니까 METHOD이다.</p><p>Retention의 경우에는 다음과 같다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">RetentionPolicy</span> <span class="o">{</span>
    <span class="cm">/**
     * Annotations are to be discarded by the compiler.
     */</span>
    <span class="no">SOURCE</span><span class="o">,</span>

    <span class="cm">/**
     * Annotations are to be recorded in the class file by the compiler
     * but need not be retained by the VM at run time.  This is the default
     * behavior.
     */</span>
    <span class="no">CLASS</span><span class="o">,</span>

    <span class="cm">/**
     * Annotations are to be recorded in the class file by the compiler and
     * retained by the VM at run time, so they may be read reflectively.
     *
     * @see java.lang.reflect.AnnotatedElement
     */</span>
    <span class="no">RUNTIME</span>
<span class="o">}</span>
</pre></table></code></div></div><p>예시로 몇개의 annotation을 살펴보자.</p><ol><li>@Override<div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">)</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">SOURCE</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">Override</span> <span class="o">{</span>
<span class="o">}</span>
</pre></table></code></div></div></ol><p>target은 method이다.<br /> retention은 source이다. -&gt; compile되고 이후에는 버려진다.</p><ol><li>@Getter<br /> ```java @Target({ElementType.FIELD, ElementType.TYPE}) @Retention(RetentionPolicy.SOURCE) public @interface Getter { /**<ul><li>If you want your getter to be non-public, you can specify an alternate access level here.<li><li>@return The getter method will be generated with this access modifier. */ lombok.AccessLevel value() default lombok.AccessLevel.PUBLIC;</ul><p>/**</p><ul><li>Any annotations listed here are put on the generated method.<li>The syntax for this feature depends on JDK version (nothing we can do about that; it’s to work around javac bugs).<br /><li>up to JDK7:<br /><li>{@code @Getter(onMethod=@__({@AnnotationsGoHere}))}<br /><li>from JDK8:<br /><li>{@code @Getter(onMethod_={@AnnotationsGohere})} // note the underscore after {@code onMethod}.<li><li>@return List of annotations to apply to the generated getter method. */ AnyAnnotation[] onMethod() default {};</ul><p>boolean lazy() default false;</p><p>/**</p><ul><li>Placeholder annotation to enable the placement of annotations on the generated code.<li>@deprecated Don’t use this annotation, ever - Read the documentation. */ @Deprecated @Retention(RetentionPolicy.SOURCE) @Target({}) @interface AnyAnnotation {} } ``` Target은 FIELD, TYPE으로 field과 class, enum, interface에 선언가능하다. <br /> Retention은 source이다.</ul><li>@SpringBootApplication</ol><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">TYPE</span><span class="o">)</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">SpringBootApplication</span> <span class="o">{</span>
    <span class="c1">// 생략</span>
<span class="o">}</span>

</pre></table></code></div></div><p>target은 class이고 retention은 runtime이다.<br /> spring이 작동되고 있는 runtime에도 해당 annotation은 유지된다.</p><ol><li>javax의 @NotNull</ol><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nd">@Target</span><span class="o">({</span> <span class="no">METHOD</span><span class="o">,</span> <span class="no">FIELD</span><span class="o">,</span> <span class="no">ANNOTATION_TYPE</span><span class="o">,</span> <span class="no">CONSTRUCTOR</span><span class="o">,</span> <span class="no">PARAMETER</span><span class="o">,</span> <span class="no">TYPE_USE</span> <span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="no">RUNTIME</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">NotNull</span> <span class="o">{</span>
    <span class="c1">// 생략</span>
<span class="o">}</span>
</pre></table></code></div></div><p>validation이라 그런지 다양한 target에 적용이 가능하고,<br /> validation은 runtime에 필요하니까 Retention은 run time이다.</p><p>한번 custom annotation을 만들어보자.<br /> 우리가 만들 annotation은 메소드 위에 붙여서 해당 메소드의 진행 시간을 체크하는 메소드이다.<br /> aop를 통해서 구현하고, 해당 메소드가 끝나면 log로 시간을 찍어보자.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">)</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">LogExecutionTime</span> <span class="o">{</span>
<span class="o">}</span>
</pre></table></code></div></div><p>일단 annotation을 만들어주자.</p><ol><li>method가 target이니까 method로 설정해준다.<li>로그를 남기려면 runtime으로 설정해야 한다.</ol><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nd">@Component</span>
<span class="nd">@Aspect</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LogAspect</span> <span class="o">{</span>
    <span class="nc">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">LogAspect</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="nd">@Around</span><span class="o">(</span><span class="s">"@annotation(LogExecutionTime)"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">logExecutionTime</span><span class="o">(</span><span class="nc">ProceedingJoinPoint</span> <span class="n">joinPoint</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Throwable</span><span class="o">{</span>
        <span class="nc">StopWatch</span> <span class="n">stopWatch</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StopWatch</span><span class="o">();</span>
        <span class="n">stopWatch</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="n">joinPoint</span><span class="o">.</span><span class="na">getSignature</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>

        <span class="nc">Object</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">joinPoint</span><span class="o">.</span><span class="na">proceed</span><span class="o">();</span>
        <span class="n">stopWatch</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">stopWatch</span><span class="o">.</span><span class="na">prettyPrint</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">ret</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><ol><li>LogAspect에서는 logger를 선언한다.<li>stopwatch 객체를 활용해서 시간을 측정하고, start()의 taskname으로 joinPoint의 signature로 설정한다.<li>proceed가 끝나면 logger.info로 log를 출력한다.</ol><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestController</span> <span class="o">{</span>

    <span class="nd">@LogExecutionTime</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/logCheck"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">logCheck</span><span class="o">(</span><span class="n">logCheckRequestDto</span> <span class="n">dto</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">dto</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>그리고 해당 url로 request를 날리면 다음과 같이 log가 남겨진다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>---------------------------------------------
ns         %     Task name
---------------------------------------------
013841600  100%  String com.example.demo.TestController.logCheck(logCheckRequestDto)
</pre></table></code></div></div><p>끝 !</p><hr /><h2 id="annotaion-processor">Annotaion processor<a href="#annotaion-processor" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Annotation을 붙이고 컴파일 타이밍때 우리가 원하는 동작을 하게 하는 핵심은 annotation processor이다.</p><p>annotation processor는 javac의 일부이다.<br /> 즉 컴파일 타이밍에 작동한다.</p><ol><li>javac가 소스 코드를 compile한다.<li>이때 annotation processor는 annotation을 보고 기존의 코드를 수정하거나 변경한다.</ol><p>한번 직접 실습으로 확인해보자.<br /> 여기서 우리는 custom한 annotation과 기존 annotation으로 샘플 클래스를 만들어보자.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@NoArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyClass</span> <span class="kd">extends</span> <span class="nc">MyParentClass</span><span class="o">{</span>

    <span class="nd">@NotNull</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">age</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="nd">@LogExecutionTime</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printMyName</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"this is child class name"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>해당 클래스를 작성하고나서 build를 해보자.<br /> 즉 compile이후에 코드가 어떻게 작성되는 확인해보는 것이다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="c1">// 해당 코드는 compile되고 나서 byte code를 decompile한 결과입니다.</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyClass</span> <span class="kd">extends</span> <span class="nc">MyParentClass</span> <span class="o">{</span>
    <span class="nd">@NotNull</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">age</span><span class="o">;</span>

    <span class="nd">@LogExecutionTime</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printMyName</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"this is child class name"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getAge</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">age</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAge</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">MyClass</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>다음과 같이 getter, setter같은 경우는 retention이 source였기 때문에 compile된 이후에는 사라지는 것을 확인할 수 있다.</p><p>그리고 @LogExecutionTime과 @NotNull같은 경우는 retention이 run time이었기 때문에 compile이후에도 유지됨을 알 수 있다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/java/'>Java</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java/" class="post-tag no-text-decoration" >Java</a> <a href="/tags/annotation/" class="post-tag no-text-decoration" >Annotation</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Annotation - 개복치의 개발 블로그&url=https://hmcck27.github.io/posts/Annotation/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Annotation - 개복치의 개발 블로그&u=https://hmcck27.github.io/posts/Annotation/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Annotation - 개복치의 개발 블로그&url=https://hmcck27.github.io/posts/Annotation/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/spring-IoC(2)/">Spring IoC (2)</a><li><a href="/posts/Annotation/">Annotation</a><li><a href="/posts/DtoToMap/">Dto to Map, with naming convention</a><li><a href="/posts/DTO%EB%A1%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B0%9B%EA%B8%B0/">controller 파라미터 map -> dto 변환과정</a><li><a href="/posts/%EB%B0%B1%EC%A4%80-14226/">백준 14226 이모티콘</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/%EC%9D%B8%EC%A6%9D-%EC%9D%B8%EA%B0%80/">인증/인가</a> <a class="post-tag" href="/tags/implementation/">implementation</a> <a class="post-tag" href="/tags/annotation/">Annotation</a> <a class="post-tag" href="/tags/bfs/">BFS</a> <a class="post-tag" href="/tags/dependency-injection/">Dependency Injection</a> <a class="post-tag" href="/tags/ioc/">IoC</a> <a class="post-tag" href="/tags/jackson/">Jackson</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/DtoToMap/"><div class="card-body"> <em class="timeago small" date="2022-04-05 00:00:00 +0800" >Apr 5</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dto to Map, with naming convention</h3><div class="text-muted small"><p> 이번에 개발하다가, 심각한 문제점을 발견했다. 우리 서비스는 spring mvc모델인데 다음과 같은 방식으로 구현되어 있다. rest api -&amp;gt; @ResponseBody를 통해서 반환 modelandview에 담아서 mv를 반환 하지만 아직 view에서의 변수 네이밍이 일치되지 않은 상황이고, 따라서 view에서는 다음과 같은 ...</p></div></div></a></div><div class="card"> <a href="/posts/DTO%EB%A1%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B0%9B%EA%B8%B0/"><div class="card-body"> <em class="timeago small" date="2022-04-06 00:00:00 +0800" >Apr 6</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>controller 파라미터 map -> dto 변환과정</h3><div class="text-muted small"><p> 제목은 DTO로 데이터 받기지만 실제로는 다음과 같은 상황을 해결하는 과정이다. 상황 ajax를 통한 통신 GET controller에서는 Map으로 받고 있는 상황 view의 json 코드의 네이밍 컨벤션 엉망(snake, camel, 대문자 혼재..) 다음과 같은 상황에서 controller에서 받는 parameter를 dto...</p></div></div></a></div><div class="card"> <a href="/posts/Map%EA%B3%BCHashMap/"><div class="card-body"> <em class="timeago small" date="2022-02-23 00:00:00 +0800" >Feb 23</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Map과 HashMap</h3><div class="text-muted small"><p> Map과 HashMap의 차이 Map이던 HashMap이던 사용할 일이 굉장히 많다. 실제로 실무에서 둘다 사용하는데 둘의 차이를 잘 모르고 사용하는 경우가 많다. 하지만 둘은 명백한 차이점이 있다. 이번 기회에 한번 그 차이점들을 정리해보자 ! Map과 HashMap의 가장 큰 차이는 키에 대한 값, 즉 key-value를 찾는 과정이 다르다...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Database-Connection-Pool/" class="btn btn-outline-primary" prompt="Older"><p>JDBC와 Database Connection Pool</p></a> <a href="/posts/DtoToMap/" class="btn btn-outline-primary" prompt="Newer"><p>Dto to Map, with naming convention</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/hmcck27">Choi Jin Kyu</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/%EC%9D%B8%EC%A6%9D-%EC%9D%B8%EA%B0%80/">인증/인가</a> <a class="post-tag" href="/tags/implementation/">implementation</a> <a class="post-tag" href="/tags/annotation/">Annotation</a> <a class="post-tag" href="/tags/bfs/">BFS</a> <a class="post-tag" href="/tags/dependency-injection/">Dependency Injection</a> <a class="post-tag" href="/tags/ioc/">IoC</a> <a class="post-tag" href="/tags/jackson/">Jackson</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
